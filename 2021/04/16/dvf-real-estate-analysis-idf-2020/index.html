<!DOCTYPE html><html lang="en">
  <head><!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-87129300-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-87129300-1');
		
	</script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>DVF: Real Estate Analysis For Île-de-France in 2020 - Mincong Huang</title>

<meta name="description" content="This article studies the real estate market of Île-de-France in 2020 by exploring and visualizing the dataset DVF using Kibana. We will discuss the global la...">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>DVF: Real Estate Analysis For Île-de-France in 2020 | Mincong Huang</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="DVF: Real Estate Analysis For Île-de-France in 2020" />
<meta name="author" content="Mincong Huang" />
<meta property="og:locale" content="en" />
<meta name="description" content="This article studies the real estate market of Île-de-France in 2020 by exploring and visualizing the dataset DVF using Kibana. We will discuss the global landscape, the impact of COVID-19, the situation in different departments, and more." />
<meta property="og:description" content="This article studies the real estate market of Île-de-France in 2020 by exploring and visualizing the dataset DVF using Kibana. We will discuss the global landscape, the impact of COVID-19, the situation in different departments, and more." />
<link rel="canonical" href="https://mincong.io/2021/04/16/dvf-real-estate-analysis-idf-2020/" />
<meta property="og:url" content="https://mincong.io/2021/04/16/dvf-real-estate-analysis-idf-2020/" />
<meta property="og:site_name" content="Mincong Huang" />
<meta property="og:image" content="https://mincong.io/assets/bg-alexander-kagan-t9Td0zfDTwI-unsplash.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-16T02:03:43+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://mincong.io/assets/bg-alexander-kagan-t9Td0zfDTwI-unsplash.jpg" />
<meta property="twitter:title" content="DVF: Real Estate Analysis For Île-de-France in 2020" />
<meta name="twitter:site" content="@mincong_h" />
<meta name="twitter:creator" content="@mincong_h" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://mincong.io/2021/04/16/dvf-real-estate-analysis-idf-2020/"},"author":{"@type":"Person","name":"Mincong Huang"},"image":"https://mincong.io/assets/bg-alexander-kagan-t9Td0zfDTwI-unsplash.jpg","description":"This article studies the real estate market of Île-de-France in 2020 by exploring and visualizing the dataset DVF using Kibana. We will discuss the global landscape, the impact of COVID-19, the situation in different departments, and more.","@type":"BlogPosting","url":"https://mincong.io/2021/04/16/dvf-real-estate-analysis-idf-2020/","headline":"DVF: Real Estate Analysis For Île-de-France in 2020","dateModified":"2021-04-16T02:03:43+02:00","datePublished":"2021-04-16T02:03:43+02:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<!-- Extra Open Graph :: Start -->

<meta property="og:image:width" content="1280"/>
<meta property="og:image:height" content="1920"/>

<!-- Extra Open Graph :: End -->

<link rel="canonical" href="https://mincong.io/2021/04/16/dvf-real-estate-analysis-idf-2020/"><link rel="alternate" type="application/rss+xml" title="Mincong Huang" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><!-- start custom head snippets -->

<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root">
<div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner">
<div class="page__header d-print-none">
<header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand">
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px" viewbox="0 0 24 24">
<style type="text/css">
	.st0{fill:#515151;}
</style>
<path class="st0" d="M1.7,22.3c5.7-5.7,11.3-5.7,17,0c3.3-3.3,3.5-5.3,0.8-6c2.7,0.7,3.5-1.1,2.3-5.6s-3.3-5.2-6.3-2.1
	c3-3,2.3-5.2-2.1-6.3S7,1.8,7.7,4.6C7,1.8,5,2.1,1.7,5.3C7.3,11,7.3,16.7,1.7,22.3"></path>
</svg>

          

          
          
          

          
          
          

          
          

          
          

          <a href="/">Mincong Huang</a>
        </div>
<button class="button button--secondary button--circle search-button js-search-toggle">
            <i class="fas fa-search"></i>
          </button>
</div>
<nav class="navigation">
        <ul>
<li class="navigation__item"><a href="/en/categories/">Categories</a></li>
<li class="navigation__item"><a href="/en/series/">Series</a></li>
<li class="navigation__item"><a href="/en/archive/">Archive</a></li>
<li class="navigation__item"><a href="/en/about/">About</a></li>
<li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li>
<li>
            <a href="/cn/">
             <img src="/assets/flag-CN.png" alt="" class="naviation__lang_img">
            </a>
          </li>
        </ul>
      </nav>
</div>
  </header>
</div>
<div class="page__content">
<div class="article__header--overlay">
<div class="hero hero--dark overlay" style="background-image:linear-gradient(135deg, rgba(0, 0, 0, .6), rgba(0, 0, 0, .4)),url(/assets/bg-alexander-kagan-t9Td0zfDTwI-unsplash.jpg);background-color:#203028;">
<div class="hero__content"><div class="main">
<div class="article__info clearfix">
      <ul class="left-col menu">
        <li>
              <a class="button button--secondary button--pill button--sm" href="/archive?tag=elasticsearch">elasticsearch</a>
            </li>
<li>
              <a class="button button--secondary button--pill button--sm" href="/archive?tag=kibana">kibana</a>
            </li>
<li>
              <a class="button button--secondary button--pill button--sm" href="/archive?tag=open-data">open-data</a>
            </li>

        <li class="separator">|</li>
          
            <li>
              <a class="button button--circle button--primary focus lang" href="/2021/04/16/dvf-real-estate-analysis-idf-2020/"><span>EN</span></a>

              






              

              
            </li>
          
        
      </ul>
<ul class="right-col menu"><li>
<i class="far fa-calendar-alt"></i> <span>Apr 16, 2021</span>
            </li></ul>
</div>
<div class="article__header"><header><h1>DVF: Real Estate Analysis For Île-de-France in 2020</h1></header></div>
<div class="article__header">
                        <p class="overlay__excerpt">To buy or not to buy?</p>
                      </div>
<div class="article__info clearfix">
  <ul class="left-col menu">
    <li>
      <i class="fas fa-camera"></i>
      
      Photo by
      <a href="https://unsplash.com/@allewollenalex" target="_blank">Alexander Kagan</a>
      
      on
      <a href="https://unsplash.com/license" target="_blank">Unplash </a>
    </li>
  </ul>
</div>
</div></div>
              </div>
            </div>
<div class="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto">
<!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><meta itemprop="headline" content="DVF: Real Estate Analysis For Île-de-France in 2020">
<meta itemprop="author" content="Mincong Huang">
<meta itemprop="datePublished" content="2021-04-16T02:03:43+02:00">
    <meta itemprop="keywords" content="elasticsearch,kibana,open-data">
<div class="js-article-content">
<div class="layout--article">
<!-- start custom article top snippet -->


<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody">
<h2 id="introduction">Introduction</h2>

<p>Open data <a href="https://www.data.gouv.fr/fr/datasets/demandes-de-valeurs-foncieres-geolocalisees/">“Demande de valeurs foncières géolocalisées
(DVF)”</a>
is an open dataset provided by the French government which collects all the
real-estate transactions since January 2014, in mainland France and the overseas
departments and territories, except in Mayotte and Alsace-Moselle. Today, we are
going to explore this dataset using Elasticsearch and Kibana. In particular, we
are going to study the real estate market of Île-de-France in 2020.</p>

<p>After reading this article, you will understand:</p>

<ul>
  <li>The prerequisite before the analytics</li>
  <li>The overview of the market Île-de-France</li>
  <li>The comparison of apartments and houses</li>
  <li>Some more specific analytics on apartments</li>
</ul>

<p>Globally, the idea is to see the big picture and identify some valuable factors to
study. Then step-by-step, we will go into a more specific direction to go
further in our exploration. Now, let’s get started!</p>

<h2 id="prerequisite">Prerequisite</h2>

<p>Before the analytics, we need to prepare the dataset. Here, I am using
<a href="https://www.elastic.co/elasticsearch/">Elasticsearch</a> and
<a href="https://www.elastic.co/kibana/">Kibana</a>. For those who don’t know Elasticsearch, Elasticsearch
is a distributed, RESTful search and analytics engine. As for Kibana, Kibana is
a free and open user interface that lets you visualize your Elasticsearch data
and navigate the Elastic Stack. The steps of the preparation are mainly the following
ones:</p>

<ol>
  <li>Download the dataset from <a href="https://www.data.gouv.fr">https://www.data.gouv.fr</a>
</li>
  <li>Design the data model and index them into Elaticsearch</li>
  <li>Optimize the storage for search</li>
  <li>Set up Kibana and create dashboards to analyze the data</li>
</ol>

<p>To set up Elasticsearch, you can use Docker: just running a Docker container in
localhost and
you are ready to go. The same thing applies to Kibana.
However, you need to give the name of the Elasticsearch cluster to Kibana so that they
can be linked together. Here, I am using the names “elasticsearch-dvf” and
“kibana-dvf” to achieve that. Once the setup is done and the indexing process is finished, you can
see all the data in Elasticsearch. There are several gigabytes (GB) of data:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  curl "localhost:9200/_cat/indices/transactions.*"
yellow open transactions.2019 ExlbB3EuQSqk__4MEW6eHQ 1 1 3142952 0 802.3mb 802.3mb
yellow open transactions.2018 1B3pKi4URDar2w0vAvPysA 1 1 3319426 0 853.3mb 853.3mb
yellow open transactions.2017 HJLTdbbtSqW686jQFzgg7g 1 1 3381190 0 862.4mb 862.4mb
yellow open transactions.2016 ZNPlUNeTStS8KsOgvaMTww 1 1 2939004 0 753.5mb 753.5mb
yellow open transactions.2015 h2CEOxWzTYymAt9KBMasJg 1 1 2750305 0 704.1mb 704.1mb
yellow open transactions.2014 17ZVk9oMQ6KmvTpMgGdMBg 1 1 2516802 0 650.7mb 650.7mb
yellow open transactions.2020 Khw7RAl1RcCDeLlz8Blt7g 1 1 2459560 0 623.5mb 623.5mb
</code></pre></div></div>

<p>On the Kibana side, we need to define an index pattern <code class="language-plaintext highlighter-rouge">transactions.*</code> that
matches all the indices mentioned above.
Since this is not aimed to be a technical blog, I am going to skip the
technical details here. If you were interested in the entire preparation, you
can see my previous articles on the series page <a href="/series/dvf">“DVF”</a>.</p>

<p>Starting from the next section, we are going to analyze the data of
Île-de-France, the Greater Paris area. It consists of 8 departments:</p>

<ul>
  <li>Paris (75)</li>
  <li>Hauts-de-Seine (92)</li>
  <li>Seine-Saint-Denis (93)</li>
  <li>Val-de-Marne (94)</li>
  <li>Seine-et-Marne (77)</li>
  <li>Yvelines (78)</li>
  <li>Essonne (91)</li>
  <li>Val-d’Oise (95)</li>
</ul>

<h2 id="overview">Overview</h2>

<h3 id="transactions-2020">Transactions 2020</h3>

<p><img src="/assets/20210416-idf-mutation-count.png" alt="2020 Ile-de-France mutation count"></p>

<p>First of all, let’s take a look at the global landscape of the real estate
market of Île-de-France in 2020. There were 146,084 transactions
happened in this area with 387,425 mutations (*). From the widget above, we can
see the number of mutations over the year. The real estate market was active
despite the pandemic. However, the number of transactions was greatly reduced
between the end of March and mid-May, probably because of the first lockdown measure
taken by the French government. After that period, the market quickly regained its dynamics.</p>

<blockquote>
  <p>(*) One mutation represents a transfer of ownership of a given premise. A premise
can be an apartment, a house, a cellar, etc. Each transaction contains one or
multiple mutations. For example, you can buy one apartment and one cellar in
the same transaction.</p>
</blockquote>

<h3 id="transactions-2014-to-2020">Transactions 2014 To 2020</h3>

<p><img src="/assets/20210416-idf-mutation-count-2014-to-2020.png" alt="2014-2020 Ile-de-France mutation count"></p>

<p>If we compare to the previous years, we can see that the market was impacted by
the COVID-19 in 2020. The total number of mutations decreased 19.5% (481,002 in 2019
vs 387,425 in 2020) in Île-de-France. Some contributing factors may be the COVID-19 measures
taken by the government (lockdown, curfew), the economic impact (partial
unemployment, complete unemployment), the psychological factor (uncertainty
about the future).</p>

<p>Before going further, let’s spend some time understanding
which part of the dataset is the most valuable for the analysis. To do that, we
can aggregate the data per field and continue our study on the most significant ones.
Here I chose the field “nature of mutation” and the field “premise type”.</p>

<p><img src="/assets/20210416-idf-nature_mutation-and-local_type.png" alt="2020 Ile-de-France distribution of nature of mutation and distribution of premise type"></p>

<p><strong>Nature of mutation.</strong> From the widget on the left side, you can see that there are several reasons
why people make a transaction: expropriation, vente terrain à bâtir
(building plot for sales), adjudication (judgement), échange (exchange), vente
(sales), and vente en l’état future d’achèvement” (sales before completion).
Most of the time it’s either “Vente” or “Vente en l’état future d’achèvement”.
That’s why I am going to focus my analysis on these two types in the following
sections.</p>

<p><strong>Premise type.</strong> From the widget on the right side, you can see the different types of premises
that people sell: local industriel, commercial ou assimilé (industrial,
commercial or related premise), maison (house), dépendance (dependent),
appartement (apartment), or empty. For those mutations having an empty type,
they can be meadows, lands, gardins, thickets, etc that we love but we
don’t have time to cover in this article. As for the “dependent” ones, they depend
on the main types: apartment, house, … where these mutations happen in the
same transaction. For example, a dependent can be a cellar. When someone buys an
apartment, he/she buys the cellar at the same time. So I am going to
filter them out as well.</p>

<p>In short, we are going to look into the sales of apartments and houses in the
next sections.</p>

<h2 id="apartment-and-house">Apartment And House</h2>

<h3 id="map">Map</h3>

<p>If we put all the sales of apartments and houses (first-hand and second-hand
combined) into a map, we can obtain the following result:</p>

<p><img src="/assets/20210416-idf-map-sales-apartments-and-houses-2020.png" alt="Map: sales of apartments and houses in Ile-de-France in 2020"></p>

<p>This map is aggregated by the municipality (commune). The color represents the
average price per meter square (€/m2) of the municipality. You can see that the
most expensive ones are all located in Paris (75) in the middle of the map with
an average price higher than 9,449 €/m2. Other municipalities around Paris are 
also expensive, especially on the west side. These departements around Paris are
called “La Petite Couronne” (The . It consists of three departments: les
Hauts-de-Seine (92), la Seine-Saint-Denis (93), and le Val-de-Marne (94).</p>

<h3 id="first-hand-vs-second-hand">First-Hand vs Second-Hand</h3>

<p>If we split the market into first-hand and second-hand, you can see that they
are actually quite different. In the widgets below, we compare the first-hand
market and second-hard market for their volume in 2020. The first one is for the entire
Île-de-France and the second one is aggregated by the department.</p>

<p><img src="/assets/20210416-idf-bar-sales-apartments-and-houses-2020-volumes.png" alt="Bar chart: volume of apartments and houses in Ile-de-France in 2020"></p>

<p>For the entire Île-de-France, the first-hand apartments and houses represent about 1.1% of
the total mutations and the second-hand ones represent 98.9%. On the right
side, you can see the actual volume of each department. The first series (red)
is for second-hand transactions and the second series (green) is for
first-hand transactions.
As you can see,
second-hand transactions represent 99.9% of the transactions in Paris (75).
In other departments, second-hand transactions represent
about 98.5% of the market. I believe that this ratio is probably related to
COVID-19 because historically speaking, the ratio of second-hand transactions is
about 93% (2014 to 2019).</p>

<h3 id="second-hand">Second-Hand</h3>

<p>Now, what if we focus on the second-hand market?</p>

<p><img src="/assets/20210416-idf-bar-sales-apartments-and-houses-2020-second-hand-volumes.png" alt="Bar chart: volume of second-hand apartments and houses in Ile-de-France in 2020"></p>

<p>If we focus on the second-hand market, we can see that there is almost no house
to sell in Paris (75). The entire market is filled with apartments (30,956
mutations). If you want to buy a house,
you probably need to go to the petite gouronne (92, 93, 94) or the grande
gouronne (77, 78, 91, 95). They have more offers. As for the price, Paris (75) is
still the champion with an average of 11,673 €/m2 for houses and 14,959 €/m2 for
the apartments. Les Hauts-de-Seine (92), le Val-de-Marne (94), and la
Seine-Saint-Denis (93) follow Paris (75) and take the top 4.</p>

<p>We are reaching the end of this section. In this section, we compared the
apartments and houses in Île-de-France. We
compared the type of sales, the volume, and the price in different departments.
In the next section, we are going to explore the market of second-hand
apartments.</p>

<h2 id="second-hand-apartments">Second-Hand Apartments</h2>

<h3 id="price">Price</h3>

<p align="center">
  <img src="/assets/20210416-idf-line-sales-apartments-price-evolution-per-department.png" alt="Line chart: median price of second-hand apartments and houses in Ile-de-France from 2016 to 2020" width="700">
</p>

<p>First of all, let’s take a look at the price. As you can see in the graph above,
the median price of Paris is significantly higher than other departments and
the trend continues in 2020 despite the global pandemic. The podium didn’t
change in 2020: les Hauts-de-Seine (92) is still in the 2nd position and followed by
le Val-de-Marne (94) at the 3rd position. However, the price of les
Hauts-de-Seine (92) dropped significantly alongside with la Seine-et-Marne (77).
If you want to have a more detailed version of the trends displayed above, here
a table of comparison for you. In this table, there is the median price of the
second-hand apartment for each department in 2015 (5 years ago), 2019 (1 year
ago), and 2020. It allows you to better follow the department that matches your
interest.</p>

<p><strong>Table: Median Price of the second-hand apartments in Île-de-France</strong></p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Department</th>
      <th style="text-align: right">2015 (€/m2)</th>
      <th style="text-align: right">5y Diff</th>
      <th style="text-align: right">2019 (€/m2)</th>
      <th style="text-align: right">1y Diff</th>
      <th style="text-align: right">2020 (€/m2)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">75 - Paris</td>
      <td style="text-align: right">8,098</td>
      <td style="text-align: right">+35.0%</td>
      <td style="text-align: right">10,218</td>
      <td style="text-align: right">+7.0%</td>
      <td style="text-align: right">10,933</td>
    </tr>
    <tr>
      <td style="text-align: left">92 - Hauts-de-Seine</td>
      <td style="text-align: right">5,463</td>
      <td style="text-align: right">+25.6%</td>
      <td style="text-align: right">6,536</td>
      <td style="text-align: right">+5.0%</td>
      <td style="text-align: right">6,860</td>
    </tr>
    <tr>
      <td style="text-align: left">93 - Seine-Saint-Denis</td>
      <td style="text-align: right">3,266</td>
      <td style="text-align: right">+25.2%</td>
      <td style="text-align: right">3,848</td>
      <td style="text-align: right">+6.3%</td>
      <td style="text-align: right">4,089</td>
    </tr>
    <tr>
      <td style="text-align: left">94 - Val-de-Marne</td>
      <td style="text-align: right">4,122</td>
      <td style="text-align: right">+21.5%</td>
      <td style="text-align: right">4,733</td>
      <td style="text-align: right">+5.8%</td>
      <td style="text-align: right">5,009</td>
    </tr>
    <tr>
      <td style="text-align: left">77 - Seine-et-Marne</td>
      <td style="text-align: right">2,989</td>
      <td style="text-align: right">+10.3%</td>
      <td style="text-align: right">3,176</td>
      <td style="text-align: right">+3.8%</td>
      <td style="text-align: right">3,296</td>
    </tr>
    <tr>
      <td style="text-align: left">78 - Yvelines</td>
      <td style="text-align: right">3,685</td>
      <td style="text-align: right">+7.6%</td>
      <td style="text-align: right">3,899</td>
      <td style="text-align: right">+1.5%</td>
      <td style="text-align: right">3,956</td>
    </tr>
    <tr>
      <td style="text-align: left">91 - Essonne</td>
      <td style="text-align: right">2,729</td>
      <td style="text-align: right">+8.7%</td>
      <td style="text-align: right">2,946</td>
      <td style="text-align: right">+0.5%</td>
      <td style="text-align: right">2,960</td>
    </tr>
    <tr>
      <td style="text-align: left">95 - Val-d’Oise</td>
      <td style="text-align: right">2,877</td>
      <td style="text-align: right">+10.7%</td>
      <td style="text-align: right">3,071</td>
      <td style="text-align: right">+3.7%</td>
      <td style="text-align: right">3,184</td>
    </tr>
  </tbody>
</table>

<h3 id="pieces">Pieces</h3>

<p>Another important factor to take into account is the number of pieces. A single
person, a young couple, a family with 2 children, … they probably don’t have
the same needs. That’s why I want to study the number of pieces so that you can
find out what matches you most. Here is the distribution of the transactions grouped by the number
of pieces. The first one is for the entire Île-de-France and the second one is aggregated by department:</p>

<p><img src="/assets/20210416-idf-composite-apartments-pieces-per-department-2020.png" alt="Number of pieces for second-hand apartments and houses in Ile-de-France from 2016 to 2020"></p>

<blockquote>
  <p><img class="emoji" title=":warning:" alt=":warning:" src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png" height="20" width="20"> On the widget on the right side, the percentage is not shown in order.
The displayed order is 2, 5, 1, 3, and other. This is because
the term having the highest percentage has to be placed first in Kibana.</p>
</blockquote>

<p>You can see that T1 and T2 represent about half of the offers in the market of
the second-hand apartments. T3 and T4 represent almost the other half. There are only a few
apartments having more than 4 pieces, maybe because people prefer houses over
apartments when they need more rooms.</p>

<h3 id="budget">Budget</h3>

<p>We talked about the price per meter square (€/m2) and the number of pieces
inside an apartment. But we didn’t talk about the total price — how many budgets
do you have? Are you ready to spend that amount of money or make a mortgage?
To let you better understand the situation, I prepared another widget. It tells
you what you can buy with a given range of budget (200K€, 400K€, 600K€, 800K€):</p>

<p><img src="/assets/20210416-idf-bar-apartments-total-price-range.png" alt="Number of pieces for second-hand apartments and houses in Ile-de-France from 2016 to 2020"></p>

<blockquote>
  <p>The color is not great but I don’t have time to make it better. I hope that it
won’t bother you too much.</p>
</blockquote>

<p>From the widget above, we can find interesting information:</p>
<ul>
  <li>If you have 200K€, you have a wide range of choices across all the
departments. You can buy an apartment at a reasonable price. It may not be
the best apartment that you want, but buying it will allow you to
start having your own property and stop wasting money on the apartment rent.
Based on the salary in Île-de-France and the constraint about the loan (up to 33%
net income), I think 200K€ is an important amount. Note that the choices are
much less for les Hauts-de-Seine (92) compared to other departments.</li>
  <li>If you have 400K€, e.g. you are buying an apartment with your partner,
you can see that the range of choices is even larger. You should be able to
find something that fits your needs in each department.</li>
  <li>For 400K€+, you can see that Paris (75) still has a lot of apartments that are
located in these ranges. They are super expensive. The buyers are probably not
normal residents but rather some real-estate investors (person or company)
or rich people. According to the Notary of France (Notaires de France), the
number of investors coming from foreign countries is not negligible. However,
the number reduced in 2020 and reached
its lowest level. For example, in the 6th district of Paris, the number
reduced from 17% in 2015 to 9.4% in Q3 2020 (<a href="https://www.notaires.fr/fr/immobilier-fiscalit%C3%A9/prix-et-tendances-de-limmobilier/analyse-du-march%C3%A9-immobilier">article link</a>).</li>
</ul>

<h2 id="going-further">Going Further</h2>

<p>How to go further from here?</p>

<ul>
  <li>To learn more about Kibana, visit Elastic’s official website
<a href="https://www.elastic.co/kibana/">https://www.elastic.co/kibana/</a>
</li>
  <li>To learn more about Elasticsearch, visit Elastic’s official website
<a href="https://www.elastic.co/elasticsearch/">https://www.elastic.co/elasticsearch/</a>
</li>
  <li>To learn more about how to use Elasticsearch for DVF, you can visit my
previous articles of this series <a href="/series/dvf">“DVF”</a>
</li>
  <li>To see the source code about this DVF project, you can visit my GitHub
repository <a href="https://github.com/mincong-h/learning-elasticsearch">mincong-h/learning-elasticsearch</a>,
the source code is under the directory “demo-dvf”.</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>In this article, we analyzed the real estate market of Île-de-France in 2020. We
started from the global landscape and ended with a more focused analysis on the
market of second-hand apartments. We
saw the market was active in 2020 despite the pandemic. The period of March to May 2020
was difficult because of the lockdown. We saw that the number of
sales-under-completion reduced significantly in 2020 compared to last years (1%
vs 7%). As for apartments, les Hauts-de-Seine (92) was impacted by the pandemic
as the median price dropped at the end of 2020. On the other hand, the
situation is more optimistic for Paris (75): the median price of second-hand
apartments in Paris (75) increased 35.0% in 5 years and the growth continued
(7.0%) in 2020. We also saw that the 400K€ is maybe enough for the greater Paris area,
but not for Paris (75).
Interested to know more? Please subscribe to <a href="/feed.xml">the feed of my blog</a>, follow me
on <a href="https://twitter.com/mincong_h">Twitter</a> or
<a href="https://github.com/mincong-h/">GitHub</a>. This will really motivate me to
write more. Hope you enjoy this article, see you the next time!</p>

<h2 id="todo">TODO</h2>

<p><em>What to do the next time?</em></p>

<p>I did this analysis for fun during my holidays and I spent 3 days on it. The
main issues were that the data preparation was very long and this is the first
time I used Kibana. Because of my limited number of day-offs, I don’t have more
time spent on it. If I can do that again in the future, here are some ideas of improvements:</p>

<ol>
  <li>Going further in the one department, e.g. Paris (75) because real estate is
highly related to geography, it does not have much added value if we only stay in
a high-level overview.</li>
  <li>Perform a prediction-related widget to forecast the trend of a given metric.</li>
  <li>Create a widget using a time-based comparison (e.g. comparing the same period
last year)</li>
  <li>Annotate some widgets to better fit the analysis.</li>
</ol>

<p>… and you, do you have suggestions for improvements or what do you want to know more
about? Please let me know by leaving a comment 🙏</p>

<h2 id="references">References</h2>

<ul>
  <li>Grégoire David, “France GeoJSON”, <em>github.com</em>, 2018.
 <a href="https://github.com/gregoiredavid/france-geojson">https://github.com/gregoiredavid/france-geojson</a>
</li>
  <li>Notaires de France, “Marché immobilier : tendance et évolution des prix de
l’immobilier”, <em>notaires.fr</em>, 2021. <a href="https://www.notaires.fr/fr/immobilier-fiscalit%C3%A9/prix-et-tendances-de-limmobilier/analyse-du-march%C3%A9-immobilier">https://www.notaires.fr/fr/immobilier-fiscalit%C3%A9/prix-et-tendances-de-limmobilier/analyse-du-march%C3%A9-immobilier</a>
</li>
  <li>PwC, “Emerging Trends in Real Estate - United States and Canada 2019”, <em>PwC</em>, 2019.
<a href="https://www.pwc.com/jg/en/publications/etre_us_2019_report.pdf">https://www.pwc.com/jg/en/publications/etre_us_2019_report.pdf</a>
</li>
  <li>Jingwen Zheng, “Second-hand apartments transactions in Île-de-France (01/2014 - 06/2020)”,
<em>jingwen-z.github.io</em>, 2021.
<a href="https://jingwen-z.github.io/second-hand-apartments-transactions-in-idf-1420/">https://jingwen-z.github.io/second-hand-apartments-transactions-in-idf-1420/</a>
</li>
</ul>
</div>
<section class="article__sharing d-print-none"></section><div class="d-print-none">
<footer class="article__footer"><meta itemprop="dateModified" content="2021-04-16T02:03:43+02:00">
<!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__subscribe"><div class="subscribe">
  <i class="fas fa-rss"></i>
  <a type="application/rss+xml" href="/feed.xml">Subscribe</a>
</div></div>
<div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by/4.0/">Attribution 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
        <img alt="Attribution 4.0 International" src="https://i.creativecommons.org/l/by/4.0/88x31.png">
      </a>
    </p>
  </div></div></footer>
<div class="article__section-navigator clearfix">
<div class="previous">
<span>PREVIOUS</span><a href="/2021/04/12/dvf-aggregations/">DVF: Aggregations</a>
</div>
<div class="next">
<span>NEXT</span><a href="/2021/04/20/an-important-change/">An Important Change</a>
</div>
</div>
</div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div>
<section class="page__comments d-print-none"><div id="disqus_thread"></div>
  <script>
  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  var disqus_config = function () {
    this.page.url = 'https://mincong.io/2021/04/16/dvf-real-estate-analysis-idf-2020/';
    this.page.identifier = '/2021/04/16/dvf-real-estate-analysis-idf-2020';
  };
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://mincong-h.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div>
</div>
<div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main">
<div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mincong Huang">
<meta itemprop="url" content="/">
<meta itemprop="description" content="I am an amazing person.">
<div class="footer__author-links">
<div class="author-links">
  <ul class="menu menu--nowrap menu--inline">
<li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:mincong.h@gmail.com" target="_blank">
        <i class="fas fa-envelope"></i>
      </a>
</li>
<li title="Follow me on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://twitter.com/mincong_h" target="_blank">
          <div class="icon">
<svg fill="#000000" width="24px" height="24px" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M1024.032 194.432c-37.664 16.704-78.176 28-120.672 33.088 43.36-26.016 76.672-67.168 92.384-116.224-40.608 24.064-85.568 41.568-133.408 50.976-38.336-40.832-92.928-66.336-153.344-66.336-116.032 0-210.08 94.048-210.08 210.08 0 16.48 1.856 32.512 5.44 47.872-174.592-8.768-329.408-92.416-433.024-219.52-18.08 31.04-28.448 67.104-28.448 105.632 0 72.896 37.088 137.184 93.472 174.88-34.432-1.088-66.816-10.528-95.168-26.272-0.032 0.864-0.032 1.76-0.032 2.656 0 101.792 72.416 186.688 168.512 205.984-17.632 4.8-36.192 7.36-55.36 7.36-13.536 0-26.688-1.312-39.52-3.776 26.72 83.456 104.32 144.192 196.256 145.888-71.904 56.352-162.496 89.92-260.928 89.92-16.96 0-33.664-0.992-50.112-2.944 92.96 59.616 203.392 94.4 322.048 94.4 386.432 0 597.728-320.128 597.728-597.76 0-9.12-0.192-18.176-0.608-27.168 41.056-29.632 76.672-66.624 104.832-108.736z"></path>
</svg>
</div>
        </a>
      </li>
<li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/mincong-huang" target="_blank">
          <div class="icon">
<svg fill="#000000" width="24px" height="24px" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0"></path>
</svg>
</div>
        </a>
      </li>
<li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/mincong-h" target="_blank">
          <div class="icon">
<svg fill="#000000" width="24px" height="24px" viewbox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z"></path>
</svg>
</div>
        </a>
      </li>
</ul>
</div>
</div>
    </div>
<div class="site-info mt-2">
      <div>© Mincong Huang 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> &amp; <a title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div>
</div>
    </div>
<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal">
<script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text">
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div>
</div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script>
    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

